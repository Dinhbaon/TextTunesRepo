name: Train ML model

on:
  push: 
    paths:
      - 'Recommendation Algo/notebook.ipynb'

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        # This is the version of the action for setting up Python, not the Python version.
        uses: actions/setup-python@v4
        with:
          # Semantic version range syntax or exact version of a Python version
          python-version: '3.10'
      - name: Install Dependencies
        run: |
          pip install -r 'Recommendation Algo/TextTunesLambda/recommendation/requirements.txt'
          python -m pip install jupyter nbconvert nbformat
          pip install kaggle
      - name: Download Kaggle dataset
        run: |
          mkdir -p "/kaggle/input/spotify-million-song-dataset"
          mkdir -p "/kaggle/input/spotify-12m-songs"
          kaggle datasets download -p "/kaggle/input/spotify-million-song-dataset" --unzip notshrirang/spotify-million-song-dataset 
          kaggle datasets download -p "/kaggle/input/spotify-12m-songs" --unzip rodolfofigueroa/spotify-12m-songs
          if [ $? -ne 0 ]; then
            echo "Error: Failed to download Kaggle datasets."
            exit 1
          fi
          ls "/kaggle/input/spotify-million-song-dataset"
          ls "/kaggle/input/spotify-12m-songs"
        env:
          KAGGLE_USERNAME: ${{ secrets.KaggleUsername }}
          KAGGLE_KEY: ${{ secrets.KaggleKey }}
      - name: Convert Notebook to python file
        run: |
          jupyter nbconvert --to script 'Recommendation Algo/notebook.ipynb'
      - name: Train Model
        run: |
          python 'Recommendation Algo/notebook.py'
          sudo ls 'Recommendation Algo'
        env:
          REPO_TOKEN: ${{ secrets.GITHUB_TOKEN }}
